Form storage
============

Forms are templates that are filled out. Forms are not considered PII/PHI,
although they do contain provenance information related to the country,
location, and entity that generated them.

Information to locate forms is stored in dynamo. All attributes are
strings.

The forms themselves are stored in an encrypted S3 bucket. Paths are:
`/<formUUID>/form.yaml`
`/<formUUID>/metadata.json`
`/<formUUID>/<image-name>.jpg` or `.png`

Forms are versioned. `formStorageVersion` corresponds to the current layout of
the form starting with `"1.0.0"`. This is the only guaranteed field in the
row. `metadata.json` describes the storage of the form, at the moment it
consists of only `{recordStorageVersion: "1.0.0"}`. If `form.yaml` exists, it is
guaranteed to have a toplevel key `recordStorageVersion`. All versions for a
record will be the same. These versions will follow semver/schemaver. See the
rules for versioning records.

|Attribute                                  | Description                                                                                | Required
|-------------------------------------------|--------------------------------------------------------------------------------------------|----------
|`country`                                  | The two letter ISO country code                                                            | Y
|`formUUID`                                 | A random v4 UUID                                                                           | Y
|`formID`                                   | A random human-understandable ID                                                           | Y
|`locationUUID`                             | A country-internal location                                                                | N
|`lanugage`                                 | Two letter lanugage code ISO 639-1 lanugage codes                                          | Y
|`officialName`                             | The full official name of this form                                                        | Y
|`name`                                     | The name of the form that providers will see                                               | Y
|`subtitle`                                 | The subtitle, can be empty                                                                 | N
|`createdDate`                              | When the form was officially created                                                       | Y
|`formId`                                   | The official ID of the form if it exists                                                   | N
|`priority`                                 | A number, highest priority is 1, within the same priority forms will be randomly organized | Y
|`version`                                  | Version numbers start by 1, increment by an integer, update as users change this form      | Y
|`createdByUUID`                            | The person who created this form                                                           | Y
|`approvedByUUID`                           | The person who approved this form                                                          | Y
|`enabled`                                  | A number, 1 is enabled, 0 is diabled                                                       | Y
|`enabledDate`                              | When the form was entered into the system                                                  | Y
|`enabledSetByUUID`                         | The person who last enabled this form                                                      | Y
|`tags`                                     | A set of tags to help organize forms, tags are always in English and will be translated    | Y
|`formStorageVersion`                       | A version that describes how this form is laid out                                         | Y
|`country_locationUUID`                     | A composite key                                                                            | Y - autogenerated
|`country_locationUUID_enabled`             | A composite key                                                                            | Y - autogenerated

NB The separator used in attribute names is underscore
   The separator used in the attribute contents is `!`
   So field country_enabled would store data sa `CA!1`
This is due to a bug in terraform which leads to errors with various characters in attribute names
Although, the AWS documentation also encourges this naming scheme

NB `!` is forbidden in any value of any field

Primary key:   `country`
Secondary key: `formUUID`

Global secondary indices:
      (when attributes aren't specified, all attributes are kept)
      (key1 and key2 are the hash and sort keys)

  1. name       : `AllActiveTagsByLocation`
     key1       : `country_locationUUID`
     key2       : `enabled`
     attributes : `Tag`
  2. name       : `AllLocationsByCountry`
     key1       : `country`
     attributes : `locationUUID`
  3. name       : `AllLanguagesByCountry`
     key1       : `country`
     attributes : `language`
  4. name       : `ByUUID`
     key1       : `formUUID`
  5. name       : `PriorityEnabledForms`
     key1       : `country_locationUUID_enabled`
     key2       : `priority`

Queries supported by the above:
 1. Look up information on a form
 2. Get all tags, languages, and locations for your country
 3. Get the detials for one form by uuid, supported by `ByUUID`
 4. Get the most important forms for your location
 5. Get the most important forms for your location by tag and/or language
